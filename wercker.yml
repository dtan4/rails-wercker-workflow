box:
  id: quay.io/dtan4/rails-test-base
  tag: latest
  registry: quay.io

services:
  - postgres:9.4

build:
  steps:
    - script:
        name: Show global envs
        code: env

rspec-models:
  steps:
    - script:
        name: Show global envs
        code: env
    - bundle-install
    - script:
        name: Set POSTGRES_USER
        code: export POSTGRES_USER=postgres
    - script:
        name: Prepare database
        code: bundle exec rake db:test:prepare
    - script:
        name: Run RSpec
        code: bundle exec rspec spec/models
    - script:
        name: Show total time
        code: script/calculate-total-time

rspec-controllers:
  steps:
    - script:
        name: Show global envs
        code: env
    - bundle-install
    - script:
        name: Set POSTGRES_USER
        code: export POSTGRES_USER=postgres
    - script:
        name: Prepare database
        code: bundle exec rake db:test:prepare
    - script:
        name: Run RSpec
        code: bundle exec rspec spec/controllers
    - script:
        name: Show total time
        code: script/calculate-total-time

rspec-features:
  steps:
    - script:
        name: Show global envs
        code: env
    - bundle-install
    - script:
        name: Set POSTGRES_USER
        code: export POSTGRES_USER=postgres
    - script:
        name: Prepare database
        code: bundle exec rake db:test:prepare
    - script:
        name: Run RSpec
        code: bundle exec rspec spec/features
    - script:
        name: Show total time
        code: script/calculate-total-time
